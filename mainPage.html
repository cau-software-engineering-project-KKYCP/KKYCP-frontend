<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KKYCP - Issue Manager</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f6f8;
            margin: 0;
            padding: 0;
        }

        header {
            background-color: #007bff;
            color: white;
            padding: 1rem 0;
            text-align: center;
            position: relative;
        }

        header h1 {
            color: white;
            margin-bottom: 1rem;
        }

        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
        }

        .action-buttons .btn {
            background-color: white;
            color: black;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            border: 1px solid #007bff;
        }

        .action-buttons .btn:hover {
            background-color: #f0f0f0;
        }

        .container {
            width: 80%;
            margin: 2rem auto;
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #007bff;
        }

        .project-select {
            margin-bottom: 1rem;
            display: flex;
            justify-content: center;
        }

        .project-select select {
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .issue-list {
            width: 100%;
            border-collapse: collapse;
        }

        .issue-list th,
        .issue-list td {
            border: 1px solid #ddd;
            padding: 8px;
        }

        .issue-list th {
            background-color: #007bff;
            color: white;
            text-align: left;
        }

        .issue-list tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        .issue-list tr:hover {
            background-color: #ddd;
        }

        .btn {
            background-color: #007bff;
            color: white;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .btn:hover {
            background-color: #0056b3;
        }

        .search-bar {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }

        .search-bar input {
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-right: 0.5rem;
            flex-grow: 2;
        }

        .search-bar select,
        .filter-select {
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-right: 0.5rem;
        }

        .search-bar button {
            padding: 0.5rem 1rem;
        }

        .no-results {
            text-align: center;
            margin-top: 1rem;
            color: #777;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgb(0, 0, 0);
            background-color: rgba(0, 0, 0, 0.4);
            padding-top: 60px;
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 500px;
            border-radius: 8px;
        }

        .modal-header,
        .modal-body,
        .modal-footer {
            padding: 10px;
        }

        .modal-header {
            background-color: #007bff;
            color: white;
            border-top-left-radius: 8px;
            border-top-right-radius: 8px;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
        }

        .modal-footer .btn {
            margin-left: 10px;
        }

        .modal-body input,
        .modal-body select,
        .modal-body textarea {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .comments {
            margin-top: 1rem;
            border-top: 1px solid #ddd;
            padding-top: 1rem;
        }

        .comment {
            margin-bottom: 1rem;
            border-bottom: 1px solid #ddd;
            padding-bottom: 0.5rem;
            display: flex;
            justify-content: space-between;
        }

        .comment-author {
            font-weight: bold;
        }

        .comment-text {
            margin-top: 0.5rem;
        }

        .comment-actions {
            margin-left: 10px;
            display: flex;
            align-items: center;
        }

        .comment-actions .btn {
            margin-left: 5px;
            background-color: #ff0000;
        }

        .comment-actions .btn-edit {
            background-color: #007bff;
        }

        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 1rem;
        }

        .pagination button {
            background: #007bff;
            color: white;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 0 2px;
        }

        .pagination button:hover {
            background: #0056b3;
        }

        .pagination button.disabled {
            background: #ccc;
            cursor: default;
        }
    </style>
</head>

<body>
    <header>
        <h1>KKYCP - Issue Manager</h1>
        <div class="action-buttons">
            <button class="btn" onclick="openUserListModal()">Participated Users</button>
            <button class="btn" onclick="openIssueStatisticsModal()">Issue Statistics</button>
        </div>
        <div class="project-select">
            <select id="projectSelect" onchange="changeProject()">
                <!-- 옵션은 나중에 동적으로 추가됩니다. -->
            </select>
        </div>
    </header>
    <div class="container">
        <div class="search-bar">
            <select id="searchOption">
                <option value="title">Title</option>
                <option value="reporter">Reporter</option>
                <option value="assignee">Assignee</option>
                <option value="type">Type</option>
            </select>
            <input type="text" id="search" placeholder="Search issues..." onkeypress="handleKeyPress(event)">
            <button class="btn" onclick="searchIssues()">Search</button>
        </div>
        <table class="issue-list">
            <thead>
                <tr>
                    <th>No.</th>
                    <th>Issue Title</th>
                    <th>Reporter</th>
                    <th>Assignee</th>
                    <th>
                        Priority
                        <select class="filter-select" id="priorityFilter" onchange="filterIssues()">
                            <option value="">All</option>
                            <option value="blocker">blocker</option>
                            <option value="critical">critical</option>
                            <option value="major">major</option>
                            <option value="minor">minor</option>
                            <option value="trivial">trivial</option>
                        </select>
                    </th>
                    <th>
                        Status
                        <select class="filter-select" id="statusFilter" onchange="filterIssues()">
                            <option value="">All</option>
                            <option value="new">new</option>
                            <option value="assigned">assigned</option>
                            <option value="resolved">resolved</option>
                            <option value="closed">closed</option>
                            <option value="reopened">reopened</option>
                        </select>
                    </th>
                    <th>Type</th>
                    <th>
                        Reported Date
                        <select class="filter-select" id="dateFilter" onchange="filterIssues()">
                            <option value="">All</option>
                            <option value="asc">Ascending</option>
                            <option value="desc">Descending</option>
                        </select>
                    </th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="issue-table-body">
                <!-- Issue rows will be inserted here dynamically -->
            </tbody>
        </table>
        <div id="no-results" class="no-results" style="display: none;">No matching items found</div>
        <button class="btn" onclick="openCreateIssueModal()">Create New Issue</button>
        <div class="pagination" id="pagination">
            <!-- Pagination buttons will be inserted here dynamically -->
        </div>
    </div>

    <!-- View Issue Modal -->
    <div id="viewModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="viewModalTitle">View Issue</h2>
            </div>
            <div class="modal-body">
                <p><strong>Description:</strong> <span id="viewDescription"></span></p>
                <p><strong>Reporter:</strong> <span id="viewReporter"></span></p>
                <p><strong>Reported Date:</strong> <span id="viewReportedDate"></span></p>
                <p><strong>Assignee:</strong> <span id="viewAssignee"></span></p>
                <p><strong>Priority:</strong> <span id="viewPriority"></span></p>
                <p><strong>Status:</strong> <span id="viewStatus"></span></p>
                <p><strong>Type:</strong> <span id="viewType"></span></p>
                <div class="comments">
                    <h3>Comments</h3>
                    <div id="viewComments"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeViewModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Edit Issue Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Issue</h2>
            </div>
            <div class="modal-body">
                <label for="editTitle">Issue Title</label>
                <input type="text" id="editTitle">
                <label for="editAssignee">Assignee</label>
                <select id="editAssignee"></select>
                <label for="editPriority">Priority</label>
                <select id="editPriority">
                    <option value="blocker">blocker</option>
                    <option value="critical">critical</option>
                    <option value="major">major</option>
                    <option value="minor">minor</option>
                    <option value="trivial">trivial</option>
                </select>
                <label for="editStatus">Status</label>
                <select id="editStatus">
                    <option value="new">new</option>
                    <option value="assigned">assigned</option>
                    <option value="resolved">resolved</option>
                    <option value="closed">closed</option>
                    <option value="reopened">reopened</option>
                </select>
                <label for="editType">Type</label>
                <input type="text" id="editType">
                <div class="comments">
                    <h3>Comments</h3>
                    <div id="editComments"></div>
                    <input type="text" id="newComment" placeholder="Add a comment..."
                        onkeypress="handleCommentKeyPress(event)">
                    <button class="btn" onclick="addComment()">Add Comment</button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeEditModal()">Cancel</button>
                <button class="btn" onclick="saveEditIssue()">Save</button>
            </div>
        </div>
    </div>

    <!-- Create Issue Modal -->
    <div id="createIssueModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Create Issue</h2>
            </div>
            <div class="modal-body">
                <label for="createTitle">Issue Title</label>
                <input type="text" id="createTitle">
                <label for="createDescription">Description</label>
                <textarea id="createDescription"></textarea>
                <label for="createAssignee">Assignee</label>
                <select id="createAssignee"></select>
                <label for="createPriority">Priority</label>
                <select id="createPriority">
                    <option value="blocker">blocker</option>
                    <option value="critical">critical</option>
                    <option value="major">major</option>
                    <option value="minor">minor</option>
                    <option value="trivial">trivial</option>
                </select>
                <label for="createStatus">Status</label>
                <select id="createStatus">
                    <option value="new">new</option>
                    <option value="assigned">assigned</option>
                    <option value="resolved">resolved</option>
                    <option value="closed">closed</option>
                    <option value="reopened">reopened</option>
                </select>
                <label for="createType">Type</label>
                <input type="text" id="createType">
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeCreateIssueModal()">Cancel</button>
                <button class="btn" onclick="saveCreateIssue()">Create</button>
            </div>
        </div>
    </div>

    <!-- Participated Users Modal -->
    <div id="userListModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Participated Users</h2>
            </div>
            <div class="modal-body">
                <table class="user-list">
                    <thead>
                        <tr>
                            <th>No.</th>
                            <th>ID</th>
                            <th>Nickname</th>
                            <th>Authorization</th>
                        </tr>
                    </thead>
                    <tbody id="user-list-body">
                        <!-- User rows will be inserted here dynamically -->
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeUserListModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Issue Statistics Modal -->
    <div id="issueStatisticsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Issue Statistics</h2>
            </div>
            <div class="modal-body">
                <label for="statisticType">Statistic Type</label>
                <select id="statisticType" onchange="generateStatistics()">
                    <option value="daily">Daily</option>
                    <option value="weekly">Weekly</option>
                    <option value="monthly">Monthly</option>
                    <option value="yearly">Yearly</option>
                </select>
                <div id="statisticsResult"></div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeIssueStatisticsModal()">Close</button>
            </div>
        </div>
    </div>

    <script>
        // DB에서 불러온 프로젝트 데이터로 초기화할 변수들
        let sampleIssues = {}; // 각 프로젝트의 이슈 데이터를 저장하는 객체
        let projects = []; // 프로젝트 목록
        let projectUsers = {}; // 프로젝트별 참여 유저 데이터

        let currentProject = null; // 현재 선택된 프로젝트
        let currentViewIssue = null;
        let currentEditIssue = null;
        let currentEditCommentIndex = null;
        let loggedInUser = 'currentUser';

        const issuesPerPage = 20; // 한 페이지에 표시할 이슈 수
        let currentPage = 1; // 현재 페이지 번호
        let totalPages = 1; // 전체 페이지 수

        // 백엔드에서 프로젝트 데이터를 가져와서 초기화하는 함수
        async function fetchProjects() {
            // 실제 API 호출 코드로 교체 필요
            // 예시: const response = await fetch('/api/projects');
            // const data = await response.json();
            const data = [
                { name: 'Project 1', description: 'Description for Project 1', createdDate: '2024-01-01', createdBy: 'Admin 1' },
                { name: 'Project 2', description: 'Description for Project 2', createdDate: '2024-02-01', createdBy: 'Admin 2' },
                { name: 'Project 3', description: 'Description for Project 3', createdDate: '2024-03-01', createdBy: 'Admin 3' },
                { name: 'Project 4', description: 'Description for Project 4', createdDate: '2024-04-01', createdBy: 'Admin 4' },
                { name: 'Project 5', description: 'Description for Project 5', createdDate: '2024-05-01', createdBy: 'Admin 5' },
                { name: 'Project 6', description: 'Description for Project 6', createdDate: '2024-06-01', createdBy: 'Admin 6' }
            ];
            projects = data;
            displayProjects();
        }

        // 프로젝트 목록을 드롭다운에 표시하는 함수
        function displayProjects() {
            const projectSelect = document.getElementById('projectSelect');
            projectSelect.innerHTML = '';

            projects.forEach(project => {
                const option = document.createElement('option');
                option.value = project.name;
                option.text = project.name;
                projectSelect.appendChild(option);
            });

            // URL 파라미터에서 선택된 프로젝트를 가져와 설정
            const urlParams = new URLSearchParams(window.location.search);
            const selectedProject = urlParams.get('project');
            if (selectedProject) {
                projectSelect.value = selectedProject;
                currentProject = selectedProject;
            } else {
                currentProject = projects.length > 0 ? projects[0].name : null;
            }

            if (currentProject) {
                fetchIssues(currentProject);
                fetchProjectUsers(currentProject);
            }
        }

        // 선택된 프로젝트의 이슈 데이터를 백엔드에서 불러오는 함수
        async function fetchIssues(projectName) {
            // 실제 API 호출 코드로 교체 필요
            // 예시: const response = await fetch(`/api/issues?project=${projectName}`);
            // const data = await response.json();
            const data = {
                'Project 1': [
                    { title: 'Sample Issue 1', description: 'Description for Sample Issue 1', reporter: 'tester1', assignee: 'dev1', priority: 'major', status: 'new', reportedDate: '2024-05-18', type: 'Bug', comments: [] },
                    { title: 'Sample Issue 2', description: 'Description for Sample Issue 2', reporter: 'tester2', assignee: 'dev2', priority: 'critical', status: 'assigned', reportedDate: '2024-05-18', type: 'Feature', comments: [] }
                ],
                'Project 2': [
                    { title: 'Project 2 Issue 1', description: 'Description for Project 2 Issue 1', reporter: 'user1', assignee: 'dev1', priority: 'major', status: 'new', reportedDate: '2024-05-10', type: 'Bug', comments: [] }
                ],
                'Project 3': [
                    { title: 'Project 3 Issue 1', description: 'Description for Project 3 Issue 1', reporter: 'user3', assignee: 'dev3', priority: 'minor', status: 'resolved', reportedDate: '2024-05-08', type: 'Docs', comments: [] }
                ],
                'Project 4': [
                    { title: 'Project 4 Issue 1', description: 'Description for Project 4 Issue 1', reporter: 'user4', assignee: 'dev4', priority: 'major', status: 'new', reportedDate: '2024-05-18', type: 'Bug', comments: [] }
                ],
                'Project 5': [
                    { title: 'Project 5 Issue 1', description: 'Description for Project 5 Issue 1', reporter: 'user5', assignee: 'dev5', priority: 'critical', status: 'assigned', reportedDate: '2024-05-19', type: 'Feature', comments: [] }
                ],
                'Project 6': [
                    { title: 'Project 6 Issue 1', description: 'Description for Project 6 Issue 1', reporter: 'user6', assignee: 'dev6', priority: 'minor', status: 'resolved', reportedDate: '2024-05-20', type: 'Docs', comments: [] }
                ]
            };
            sampleIssues[projectName] = data[projectName] || [];
            totalPages = Math.ceil(sampleIssues[projectName].length / issuesPerPage);
            displayIssues(sampleIssues[projectName], currentPage);
        }

        // 선택된 프로젝트의 참여 유저 데이터를 백엔드에서 불러오는 함수
        async function fetchProjectUsers(projectName) {
            // 실제 API 호출 코드로 교체 필요
            // 예시: const response = await fetch(`/api/projects/${projectName}/users`);
            // const data = await response.json();
            const data = {
                'Project 1': [
                    { id: 'user1', nickname: 'User One', role: 'PL' },
                    { id: 'user2', nickname: 'User Two', role: 'dev' },
                    { id: 'user3', nickname: 'User Three', role: 'tester' }
                ],
                'Project 2': [
                    { id: 'user4', nickname: 'User Four', role: 'dev' },
                    { id: 'user5', nickname: 'User Five', role: 'PL' },
                    { id: 'user6', nickname: 'User Six', role: 'tester' }
                ],
                'Project 3': [
                    { id: 'user7', nickname: 'User Seven', role: 'dev' },
                    { id: 'user8', nickname: 'User Eight', role: 'PL' },
                    { id: 'user9', nickname: 'User Nine', role: 'tester' }
                ],
                'Project 4': [
                    { id: 'user10', nickname: 'User Ten', role: 'PL' },
                    { id: 'user11', nickname: 'User Eleven', role: 'dev' },
                    { id: 'user12', nickname: 'User Twelve', role: 'tester' }
                ],
                'Project 5': [
                    { id: 'user13', nickname: 'User Thirteen', role: 'PL' },
                    { id: 'user14', nickname: 'User Fourteen', role: 'dev' },
                    { id: 'user15', nickname: 'User Fifteen', role: 'tester' }
                ],
                'Project 6': [
                    { id: 'user16', nickname: 'User Sixteen', role: 'PL' },
                    { id: 'user17', nickname: 'User Seventeen', role: 'dev' },
                    { id: 'user18', nickname: 'User Eighteen', role: 'tester' }
                ]
            };
            projectUsers[projectName] = data[projectName] || [];
        }

        // 프로젝트 변경 시 호출되는 함수
        function changeProject() {
            const projectSelect = document.getElementById('projectSelect');
            currentProject = projectSelect.value;
            fetchIssues(currentProject);
            fetchProjectUsers(currentProject);
        }

        // 이슈 리스트를 화면에 표시하는 함수
        function displayIssues(issues, page) {
            const issueTableBody = document.getElementById('issue-table-body');
            const noResults = document.getElementById('no-results');
            issueTableBody.innerHTML = '';

            if (issues.length === 0) {
                noResults.style.display = 'block';
            } else {
                noResults.style.display = 'none';
                const start = (page - 1) * issuesPerPage;
                const end = start + issuesPerPage;
                const paginatedIssues = issues.slice(start, end);

                paginatedIssues.forEach((issue, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${start + index + 1}</td>
                        <td>${issue.title}</td>
                        <td>${issue.reporter}</td>
                        <td>${issue.assignee}</td>
                        <td>${issue.priority}</td>
                        <td>${issue.status}</td>
                        <td>${issue.type}</td>
                        <td>${issue.reportedDate}</td>
                        <td>
                            <button class="btn" onclick="viewIssue('${issue.title}')">View</button>
                            <button class="btn" onclick="editIssue('${issue.title}')">Edit</button>
                            <button class="btn" onclick="deleteIssue('${issue.title}')">Del</button>
                        </td>
                    `;
                    issueTableBody.appendChild(row);
                });
            }

            updatePagination();
        }

        // 페이지네이션 업데이트 함수
        function updatePagination() {
            const pagination = document.getElementById('pagination');
            pagination.innerHTML = '';

            for (let i = 1; i <= totalPages; i++) {
                const button = document.createElement('button');
                button.textContent = i;
                if (i === currentPage) {
                    button.classList.add('disabled');
                    button.disabled = true;
                } else {
                    button.onclick = () => changePage(i);
                }
                pagination.appendChild(button);
            }
        }

        // 페이지 변경 함수
        function changePage(page) {
            currentPage = page;
            displayIssues(sampleIssues[currentProject], page);
        }

        // 이슈 검색 함수
        function searchIssues() {
            const searchQuery = document.getElementById('search').value.toLowerCase();
            const searchOption = document.getElementById('searchOption').value;
            const filteredIssues = sampleIssues[currentProject].filter(issue =>
                issue[searchOption].toLowerCase().includes(searchQuery)
            );
            totalPages = Math.ceil(filteredIssues.length / issuesPerPage);
            currentPage = 1;
            displayIssues(filteredIssues, currentPage);
        }

        // 필터링된 이슈를 화면에 표시하는 함수
        function filterIssues() {
            const priorityFilter = document.getElementById('priorityFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            const dateFilter = document.getElementById('dateFilter').value;

            let filteredIssues = sampleIssues[currentProject].filter(issue =>
                (priorityFilter === "" || issue.priority === priorityFilter) &&
                (statusFilter === "" || issue.status === statusFilter)
            );

            if (dateFilter === "asc") {
                filteredIssues.sort((a, b) => new Date(a.reportedDate) - new Date(b.reportedDate));
            } else if (dateFilter === "desc") {
                filteredIssues.sort((a, b) => new Date(b.reportedDate) - new Date(a.reportedDate));
            }

            totalPages = Math.ceil(filteredIssues.length / issuesPerPage);
            currentPage = 1;
            displayIssues(filteredIssues, currentPage);
        }

        // 엔터 키 입력 시 검색 함수 호출
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                searchIssues();
            }
        }

        // 엔터 키 입력 시 댓글 추가 함수 호출
        function handleCommentKeyPress(event) {
            if (event.key === 'Enter') {
                addComment();
            }
        }

        // 새로운 이슈를 생성하는 모달 열기
        function openCreateIssueModal() {
            loadAssigneeOptions('createAssignee'); // Assignee 목록을 로드
            document.getElementById('createIssueModal').style.display = 'block';
        }

        // 새로운 이슈 생성 모달 닫기
        function closeCreateIssueModal() {
            document.getElementById('createIssueModal').style.display = 'none';
        }

        // 새로운 이슈를 저장하는 함수
        function saveCreateIssue() {
            const title = document.getElementById('createTitle').value;
            const description = document.getElementById('createDescription').value;
            const assignee = document.getElementById('createAssignee').value;
            const priority = document.getElementById('createPriority').value;
            const status = document.getElementById('createStatus').value;
            const type = document.getElementById('createType').value;
            const reportedDate = new Date().toISOString().split('T')[0];
            const reporter = loggedInUser;

            if (title && description) {
                const newIssue = { title, description, reporter, assignee, priority, status, reportedDate, type, comments: [] };
                sampleIssues[currentProject].push(newIssue);
                // 새로운 이슈를 백엔드에 저장하는 로직이 추가되어야 합니다.
                totalPages = Math.ceil(sampleIssues[currentProject].length / issuesPerPage);
                displayIssues(sampleIssues[currentProject], currentPage);
                closeCreateIssueModal();
            }
        }

        // 이슈를 조회하는 함수
        function viewIssue(title) {
            currentViewIssue = sampleIssues[currentProject].find(issue => issue.title === title);
            if (currentViewIssue) {
                document.getElementById('viewModalTitle').innerText = currentViewIssue.title; // 모달 제목에 이슈 제목 표시
                document.getElementById('viewDescription').innerText = currentViewIssue.description;
                document.getElementById('viewReporter').innerText = currentViewIssue.reporter;
                document.getElementById('viewReportedDate').innerText = currentViewIssue.reportedDate;
                document.getElementById('viewAssignee').innerText = currentViewIssue.assignee;
                document.getElementById('viewPriority').innerText = currentViewIssue.priority;
                document.getElementById('viewStatus').innerText = currentViewIssue.status;
                document.getElementById('viewType').innerText = currentViewIssue.type;
                displayComments('viewComments', currentViewIssue.comments, false);
                document.getElementById('viewModal').style.display = 'block';
            }
        }

        // 이슈 조회 모달을 닫는 함수
        function closeViewModal() {
            document.getElementById('viewModal').style.display = 'none';
        }

        // 이슈를 편집하는 함수
        function editIssue(title) {
            currentEditIssue = sampleIssues[currentProject].find(issue => issue.title === title);
            if (currentEditIssue) {
                document.getElementById('editTitle').value = currentEditIssue.title;
                document.getElementById('editAssignee').value = currentEditIssue.assignee;
                document.getElementById('editPriority').value = currentEditIssue.priority;
                document.getElementById('editStatus').value = currentEditIssue.status;
                document.getElementById('editType').value = currentEditIssue.type;
                loadAssigneeOptions('editAssignee');
                displayComments('editComments', currentEditIssue.comments, true);
                document.getElementById('editModal').style.display = 'block';
            }
        }

        // 이슈 편집 모달을 닫는 함수
        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
        }

        // 이슈 편집 내용을 저장하는 함수
        function saveEditIssue() {
            if (currentEditIssue) {
                currentEditIssue.title = document.getElementById('editTitle').value;
                currentEditIssue.assignee = document.getElementById('editAssignee').value;
                currentEditIssue.priority = document.getElementById('editPriority').value;
                currentEditIssue.status = document.getElementById('editStatus').value;
                currentEditIssue.type = document.getElementById('editType').value;
                displayIssues(sampleIssues[currentProject], currentPage);
                closeEditModal();
            }
        }

        // 새로운 댓글을 추가하는 함수
        function addComment() {
            const commentText = document.getElementById('newComment').value;
            if (commentText && currentEditIssue) {
                currentEditIssue.comments.push({ author: loggedInUser, text: commentText, date: new Date().toISOString() });
                displayComments('editComments', currentEditIssue.comments, true);
                document.getElementById('newComment').value = '';
            }
        }

        // 댓글을 편집하는 함수
        function editComment(index) {
            currentEditCommentIndex = index;
            document.getElementById('editCommentText').value = currentEditIssue.comments[index].text;
            document.getElementById('editCommentModal').style.display = 'block';
        }

        // 댓글 편집 모달을 닫는 함수
        function closeEditCommentModal() {
            document.getElementById('editCommentModal').style.display = 'none';
        }

        // 댓글 편집 내용을 저장하는 함수
        function saveEditComment() {
            if (currentEditCommentIndex !== null && currentEditIssue) {
                currentEditIssue.comments[currentEditCommentIndex].text = document.getElementById('editCommentText').value;
                displayComments('editComments', currentEditIssue.comments, true);
                closeEditCommentModal();
            }
        }

        // 댓글을 삭제하는 함수
        function deleteComment(index) {
            if (currentEditIssue) {
                currentEditIssue.comments.splice(index, 1);
                displayComments('editComments', currentEditIssue.comments, true);
            }
        }

        // 댓글을 화면에 표시하는 함수
        function displayComments(containerId, comments, isEditable) {
            const commentContainer = document.getElementById(containerId);
            commentContainer.innerHTML = '';
            comments.forEach((comment, index) => {
                const commentElement = document.createElement('div');
                commentElement.classList.add('comment');
                commentElement.innerHTML = `
                    <div>
                        <div class="comment-author">${comment.author}</div>
                        <div class="comment-date">${new Date(comment.date).toLocaleString()}</div>
                        <div class="comment-text">${comment.text}</div>
                    </div>
                    ${isEditable ? `
                    <div class="comment-actions">
                        <button class="btn btn-edit" onclick="editComment(${index})">Edit</button>
                        <button class="btn" onclick="deleteComment(${index})">Delete</button>
                    </div>
                    ` : ''}
                `;
                commentContainer.appendChild(commentElement);
            });
        }

        // 이슈를 삭제하는 함수
        function deleteIssue(title) {
            sampleIssues[currentProject] = sampleIssues[currentProject].filter(issue => issue.title !== title);
            totalPages = Math.ceil(sampleIssues[currentProject].length / issuesPerPage);
            if (currentPage > totalPages) currentPage = totalPages;
            displayIssues(sampleIssues[currentProject], currentPage);
        }

        // 참여 유저 목록 모달 열기
        function openUserListModal() {
            displayProjectUsers();
            document.getElementById('userListModal').style.display = 'block';
        }

        // 참여 유저 목록 모달 닫기
        function closeUserListModal() {
            document.getElementById('userListModal').style.display = 'none';
        }

        // 현재 프로젝트의 참여 유저 목록을 표시하는 함수
        function displayProjectUsers() {
            const userListBody = document.getElementById('user-list-body');
            userListBody.innerHTML = '';
            const users = projectUsers[currentProject] || [];

            users.forEach((user, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${user.id}</td>
                    <td>${user.nickname}</td>
                    <td>${user.role}</td>
                `;
                userListBody.appendChild(row);
            });
        }

        // 이슈 통계를 생성하는 함수
        function generateStatistics() {
            const statisticType = document.getElementById('statisticType').value;
            const statisticsResult = document.getElementById('statisticsResult');
            const issues = sampleIssues[currentProject];
            let statistics = {};

            if (statisticType === 'daily') {
                statistics = issues.reduce((acc, issue) => {
                    const date = issue.reportedDate;
                    if (!acc[date]) acc[date] = 0;
                    acc[date]++;
                    return acc;
                }, {});
            } else if (statisticType === 'weekly') {
                statistics = issues.reduce((acc, issue) => {
                    const date = new Date(issue.reportedDate);
                    const week = `${date.getFullYear()}-W${Math.ceil((date.getDate() + (date.getDay() + 1)) / 7)}`;
                    if (!acc[week]) acc[week] = 0;
                    acc[week]++;
                    return acc;
                }, {});
            } else if (statisticType === 'monthly') {
                statistics = issues.reduce((acc, issue) => {
                    const date = issue.reportedDate.slice(0, 7); // YYYY-MM
                    if (!acc[date]) acc[date] = 0;
                    acc[date]++;
                    return acc;
                }, {});
            } else if (statisticType === 'yearly') {
                statistics = issues.reduce((acc, issue) => {
                    const date = issue.reportedDate.slice(0, 4); // YYYY
                    if (!acc[date]) acc[date] = 0;
                    acc[date]++;
                    return acc;
                }, {});
            }

            statisticsResult.innerHTML = '<h3>Statistics Result</h3>';
            for (let [key, value] of Object.entries(statistics)) {
                statisticsResult.innerHTML += `<p>${key}: ${value} issues</p>`;
            }
        }

        // 이슈 통계 모달 열기
        function openIssueStatisticsModal() {
            generateStatistics();
            document.getElementById('issueStatisticsModal').style.display = 'block';
        }

        // 이슈 통계 모달 닫기
        function closeIssueStatisticsModal() {
            document.getElementById('issueStatisticsModal').style.display = 'none';
        }

        // Assignee 옵션을 로드하는 함수
        function loadAssigneeOptions(selectId) {
            const select = document.getElementById(selectId);
            select.innerHTML = '';
            const devUsers = projectUsers[currentProject].filter(user => user.role === 'dev');

            devUsers.forEach(user => {
                const option = document.createElement('option');
                option.value = user.nickname;
                option.text = user.nickname;
                select.appendChild(option);
            });
        }

        fetchProjects(); // 초기 프로젝트 데이터를 가져옵니다.
    </script>
</body>

</html>